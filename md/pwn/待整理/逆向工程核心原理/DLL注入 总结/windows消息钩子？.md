---
title: windows消息钩子？
updated: 2021-04-14T17:18:56.0000000+08:00
created: 2021-04-09T14:16:43.0000000+08:00
---

DllMain的DLL_PROCESS_ATTACH什么时候进入？
为什么别的进程不会进入？

为什么两次结果不一样？
为什么要用Dll？
SetWindowsHookEx实现过程

*来自 \<<https://blog.csdn.net/Y_sl_itachi/article/details/112862761>\>*
**
如果创建的是全局钩子，那么钩子函数必须在一个DLL中。这是因为进程的地址空间是独立的，发生对应事件的进程不能调用其他进程地址空间的钩子函数。如果钩子函数的实现代码在DLL中，则在对应事件发生时，系统会把这个DLL加载到发生事件

的进程地址空间中，使它能够调用钩子函数进行处理。

在操作系统中安装全局钩子后，只要进程接收到可以发出钩子的消息，全局钩子的DLL文件就会由操作系统自动或强行地加载到该进程中。因此，设置全局钩子可以达到DLL注入的目的。创建一个全局钩子后，在对应事件发生的时候，系统就会把DLL

加载到发生事件的进程中，这样，便实现了DLL注入。

为什么安装钩子要在Dll中进行？
因为要得到钩子句柄，dll句柄，回调函数地址。

回调函数里要用到钩子句柄。

可是，安装钩子时用到dll模块句柄和回调函数地址，只安装一次钩子，在不在dll里都可以。之后进程，如果加载Dll的地址改变，怎么能定位到这些地址呢？

那怎么实现安装钩子不在Dll中进行？
【干货】Windows进程注入之SetWindowsHookEx

*来自 \<<https://blog.csdn.net/weixin_34342207/article/details/88721250>\>*
**
回调函数HookProc里得到自己的钩子句柄？不行

回调函数可不可以不传钩子句柄？

不知道为什么卡死了，用64位？

测试
用x64dbg查看dll段，查看pe结构

写hook程序

加载时输出hmodule和hookhandle，先看看初值是什么

回调时输出hmodule和hookhandle

查看不同进程的值是否相同

检查全局变量初始化会怎样

**\[原创\]萌新逆向学习笔记——消息钩子键盘记录**

*来自 \<<https://bbs.pediy.com/thread-261399.htm>\>*
钩子原理及实例：利用鼠标键盘钩子截获密码
为什么把钩子句柄，dll句柄变成全局共享数据变量？
*来自 \<<https://blog.csdn.net/ljheee/article/details/52040233>\>*

